<div class="container">
  <div class-"d-flex row">
    <div class="col-sm-3">
      <!--- カテゴリ(科目・資格検索) -->
      <%= render 'search_category', categories: @categories %>
    </div>
    <div class="col-sm-9">
      <h3 class="text-center">"<%= @category.name %>"のお気に入り数ランキング</h3>
      <!-- 同率順位表示 -->
      <% lastFavorite = 0 %>
      <% j = 1 %>
      <!--- いいね数ランキング -->
      <% @post_ranks.each.with_index(1) do |post,i| %>
      <!-- 投稿ステータス確認 -->
      <% if post.is_active %>
        <% if i == 1 %>
          <% lastFavorite = post.favorites.count %>
        <% end %>
        <% if post.favorites.count != lastFavorite %>
          <% j = i %>
          <h5 class="text-center mt-4">
            <% case j when 1 %>
              <i class="fas fa-crown" style='color: gold;'></i>第<%= j %>位
            <% when 2 %>
              <i class="fas fa-crown" style='color: silver;'></i>第<%= j %>位
            <% when 3 %>
              <i class="fas fa-crown" style='color: orange;'></i>第<%= j %>位
            <% else %>
              第<%= j %>位
            <% end %>
          </h5>
          <% lastFavorite = post.favorites.count %>
        <% else %>
          <% lastFavorite = post.favorites.count %>
          　<h5 class="text-center mt-4">
            　<% case j when 1 %>
              　<i class="fas fa-crown" style='color: gold;'></i>第<%= j %>位
            　<% when 2 %>
              　<i class="fas fa-crown" style='color: silver;'></i>第<%= j %>位
          　　  <% when 3 %>
                <i class="fas fa-crown" style='color: orange;'></i>第<%= j %>位
          　　  <% else %>
                第<%= j %>位
              <% end %>
            </h5>
        <% end %>
        <div class="card border-warning mx-auto w-75 mt-4 shadow-lg p-3">
          <%= link_to post_path(post.id) do %>
          　<% image_tag post.get_image %>
  　　　　　　　<% end %>
  　　　   　<div class="card-body">
    　　　   　<h5 class="card-title">
        　　　　<b>科目・資格名</b>: <%= post.category.name %>
    　  　　　</h5>
  　  　　　</div>
  　　   　　<ul class="list-group list-group-flush">
  　　   　    <li class="list-group-item">
              <b>分野</b>: <%= post.field %>
            </li>
            <li class="list-group-item">
              <b>参考書・アプリ</b>: <%= post.reference_book %>
            </li>
            <li class="list-group-item">
              <b>勉強方法</b>: <%= post.study_method %>
            </li>
            <li class="list-group-item">
             <b>総学習時間</b>: <%= post.total_study_time %>時間
            </li>
            <li class="list-group-item">
             <b>成果</b>: <%= post.achievement %>
            </li>
          </ul>
          <div class="card-body">
           <div class="row">
             <div class="col-sm-2">
               <%= image_tag post.enduser.get_profile_image(80,80), class:"rounded-circle" %>
             </div>
             <div class="col-sm-10">
               <%= link_to enduser_path(post.enduser.id) do %>
                 <span><i class="fas fa-user"></i> By <%= post.enduser.name %> | </span>
               <% end %>
               <span><%= post.created_at.strftime('%Y/%m/%d') %> |</span>
               <span>
                 <%= link_to post_path(post.id) do %>
                   <i class="fa-regular fa-comment-dots"></i>
                   <%= post.post_comments.count %> |
                 <% end %>
               </span>
               <% if post.favorited_by?(current_enduser) %>
                 <%= link_to post_favorite_path(post), method: :delete do %>
                   <i class="fa-regular fa-heart"></i> <%= post.favorites.count %>
                 <% end %>
               <% else %>
                 <%= link_to post_favorite_path(post), method: :post do %>
                   <i class="fa-regular fa-heart"></i> <%= post.favorites.count %>
                 <% end %>
               <% end %>
             </div>
           </div>
           <P class="mt-2"><%= link_to "#{post.post_comments.count}件コメント", post_path(post.id) %></P>
         </div>
      </div>
      <% end %>
      <% end %>
    </div>
  </div>
</div>

